# Архитектура приложения для прогнозирования оттока клиентов

## Общая информация

Приложение представляет собой веб-интерфейс для прогнозирования вероятности оттока клиентов телекоммуникационной компании на основе обученной модели машинного обучения XGBoost. Приложение реализовано с использованием Flask и имеет минималистичный дизайн.

## Структура приложения

```
telco_churn_prediction/
├── app/                       # Директория приложения
│   ├── templates/             # HTML-шаблоны
│   │   ├── base.html          # Базовый шаблон
│   │   ├── index.html         # Главная страница с формой ввода
│   │   ├── result.html        # Страница с результатами прогноза
│   │   └── error.html         # Страница с ошибками
│   ├── utils/                 # Вспомогательные модули
│   │   ├── __init__.py        # Инициализация пакета
│   │   └── model_utils.py     # Модуль для работы с моделью
│   ├── __init__.py            # Инициализация пакета app
│   └── app.py                 # Основной файл Flask-приложения
├── models/                    # Директория с моделями
│   ├── best_model.joblib      # Лучшая модель (XGBoost)
│   └── preprocessor.joblib    # Препроцессор для данных
└── docs/                      # Документация
    └── app_architecture.md    # Описание архитектуры приложения
```

## Компоненты приложения

### 1. Основной файл приложения (app.py)

- **Функция**: Основная логика Flask-приложения
- **Маршруты**:
  - `/` - Главная страница с формой ввода данных клиента
  - `/predict` - Обработка данных формы и отображение результатов прогноза
  - `/api/predict` - API-эндпоинт для получения прогноза в формате JSON
- **Действия**:
  - Загрузка модели и препроцессора при запуске приложения
  - Рендеринг HTML-шаблонов
  - Обработка данных формы
  - Получение прогноза от модели
  - Отображение результатов пользователю

### 2. Модуль для работы с моделью (model_utils.py)

- **Функция**: Содержит логику для работы с моделью машинного обучения
- **Основные функции**:
  - `load_model_and_preprocessor()` - Загрузка модели и препроцессора из файлов
  - `prepare_data()` - Преобразование данных клиента в формат для модели
  - `predict_churn()` - Получение прогноза оттока клиента

### 3. HTML-шаблоны

- **base.html** - Базовый шаблон с общей структурой всех страниц
- **index.html** - Форма для ввода данных клиента
- **result.html** - Отображение результатов прогноза
- **error.html** - Отображение информации об ошибках

## Потоки данных

1. **Ввод данных**:
   - Пользователь заполняет форму на главной странице
   - Данные отправляются на сервер при помощи POST-запроса

2. **Обработка данных**:
   - Данные преобразуются в формат словаря
   - Специальные преобразования (например, SeniorCitizen из 'Yes'/'No' в 1/0)
   - Данные преобразуются в DataFrame
   - Применяется препроцессор для масштабирования и кодирования

3. **Прогнозирование**:
   - Модель XGBoost применяется к преобразованным данным
   - Получается прогноз (0/1) и вероятность оттока

4. **Вывод результатов**:
   - Для веб-интерфейса: отображение на странице result.html
   - Для API: возврат JSON-ответа

## Интеграция с моделью

Интеграция с моделью осуществляется через модуль model_utils.py:

1. **Загрузка модели**:
   - Модель и препроцессор загружаются один раз при запуске приложения
   - Используется библиотека joblib для загрузки .joblib файлов

2. **Предобработка данных**:
   - Автоматическое определение типа данных (категориальные/числовые)
   - Применение сохраненного препроцессора (трансформации, масштабирование)

3. **Прогнозирование**:
   - Получение вероятности оттока с помощью метода predict_proba
   - Получение бинарного прогноза с помощью метода predict

## Инструкции по запуску приложения

1. Активировать виртуальное окружение:
   ```bash
   source venv/bin/activate  # Linux/Mac
   venv\Scripts\activate     # Windows
   ```

2. Установить зависимости:
   ```bash
   pip install -r requirements.txt
   ```

3. Запустить приложение:
   ```bash
   cd telco_churn_prediction
   python -m app.app
   ```

4. Открыть приложение в браузере по адресу: http://127.0.0.1:5000/

## Возможные улучшения

1. **Производительность**:
   - Кэширование результатов прогноза для частых запросов
   - Оптимизация загрузки моделей (например, использование pickle вместо joblib)

2. **Безопасность**:
   - Добавление валидации входных данных
   - Защита от CSRF-атак
   - Ограничение доступа к API

3. **UI/UX**:
   - Добавление визуализаций результатов (графики, диаграммы)
   - Улучшение мобильной версии интерфейса
   - Добавление подсказок для полей формы

4. **Функциональность**:
   - Пакетное прогнозирование для нескольких клиентов
   - Возможность сохранения и загрузки данных клиентов
   - Авторизация и аутентификация пользователей 