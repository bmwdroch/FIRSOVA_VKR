# Развертывание приложения для прогнозирования оттока клиентов в Docker

Данное руководство описывает процесс развертывания приложения для прогнозирования оттока клиентов с использованием Docker и Docker Compose.

## Особенности развертывания

- Приложение запускается внутри Docker-контейнера
- Nginx используется в качестве обратного прокси и для обеспечения дополнительной безопасности
- Уникальный URL-путь для доступа к приложению (защита от автоматического сканирования)
- Возможность добавления SSL-сертификата для HTTPS

## Предварительные требования

- Установленный Docker: [https://docs.docker.com/get-docker/](https://docs.docker.com/get-docker/)
- Установленный Docker Compose: [https://docs.docker.com/compose/install/](https://docs.docker.com/compose/install/)

## Подготовка к развертыванию

1. Создайте файл `.env` на основе примера ниже:

```
# Секретный ключ для Flask (используйте сильный случайный ключ)
SECRET_KEY=your_strong_secret_key_here

# Уникальный путь для доступа к приложению (используйте сложный для подбора путь)
APP_PATH_KEY=your_secure_random_path

# Настройки Flask
FLASK_DEBUG=false
```

Обязательно замените `your_strong_secret_key_here` и `your_secure_random_path` на свои уникальные значения. 
Для генерации случайного ключа можно использовать команду:

```bash
openssl rand -hex 16
```

## Запуск приложения

1. Убедитесь, что вы находитесь в директории `telco_churn_prediction` (где расположен файл `docker-compose.yml`)

2. Создайте директорию для конфигурации Nginx:

```bash
mkdir -p nginx
```

3. Постройте и запустите контейнеры:

```bash
docker-compose up -d
```

4. Проверьте, что оба контейнера запущены:

```bash
docker-compose ps
```

Вы должны увидеть два контейнера в статусе "Up":
- telco_churn_app
- telco_churn_nginx

## Доступ к приложению

Приложение будет доступно по адресу:

```
http://ваш_ip_или_домен/your_secure_random_path
```

где `your_secure_random_path` - это значение переменной APP_PATH_KEY, которое вы указали в файле `.env`.

## Настройка SSL (HTTPS)

Для настройки HTTPS:

1. Получите SSL-сертификат (например, с помощью Let's Encrypt)

2. Создайте директорию для сертификатов:

```bash
mkdir -p nginx/ssl
```

3. Поместите ваши сертификаты в директорию `nginx/ssl`:
   - `cert.pem` - сертификат
   - `key.pem` - приватный ключ

4. Раскомментируйте соответствующие строки в файлах `docker-compose.yml` и `nginx/nginx.conf`

5. Перезапустите контейнеры:

```bash
docker-compose down
docker-compose up -d
```

## Обновление приложения

Для обновления приложения:

1. Внесите необходимые изменения в код

2. Пересоберите и перезапустите контейнеры:

```bash
docker-compose down
docker-compose build
docker-compose up -d
```

## Мониторинг логов

Для просмотра логов:

```bash
# Все контейнеры
docker-compose logs -f

# Только приложение
docker-compose logs -f app

# Только Nginx
docker-compose logs -f nginx
```

## Устранение неполадок

### Приложение недоступно

1. Проверьте, что оба контейнера запущены:

```bash
docker-compose ps
```

2. Проверьте логи:

```bash
docker-compose logs
```

3. Убедитесь, что вы используете правильный URL-путь (значение APP_PATH_KEY)

4. Проверьте доступность порта 80 на вашем сервере:

```bash
curl localhost:80
```

### Ошибка при загрузке модели

Если возникает ошибка при загрузке модели, убедитесь, что файлы моделей корректно монтируются в контейнер:

```bash
docker-compose exec app ls -la /app/models
```

## Меры безопасности

В текущей конфигурации используются следующие меры безопасности:

1. Уникальный URL-путь, который скрывает приложение от автоматического сканирования
2. HTTP-заголовки для защиты от распространенных веб-уязвимостей
3. Ограничение размера запросов для предотвращения DoS-атак
4. Отключение доступа к скрытым файлам

Для продакшн-окружения рекомендуется также:

1. Настроить HTTPS (как описано выше)
2. Регулярно обновлять образы Docker
3. Использовать систему мониторинга для отслеживания попыток несанкционированного доступа
4. Настроить брандмауэр для ограничения доступа только с определенных IP-адресов (если необходимо) 